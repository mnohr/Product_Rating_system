@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@*@model systemrating.Data.EntityModels.Product*@
@model systemrating.Data.EntityModels.Review
@{
	object userSession =  Context.Session.GetString("Username");

}

	
	<div class="container">
		<div class="card">
			<div class="container-fliud">
				<div class="wrapper row">
					<div class="preview col-md-6">
						
						<div class="preview-pic tab-content">
						  <div class="tab-pane active" id="pic-1"><img src="http://placekitten.com/400/252" /></div>

						</div>
					</div>
					<div class="details col-md-6">
						
					@foreach(var item in ViewBag.Product)
					{
						<h3 class="product-title">@item.Name</h3>
					
						
						<p class="product-description">@item.Description</p>
						<h4 class="price">current price: <span>$@item.Price</span></h4>
						@*<p class="vote"><strong>91%</strong> of buyers enjoyed this product! <strong>(87 votes)</strong></p>*@
						@if (@item.Quantity > 0)
						{
							<h4 class="price">Quantity <span>@item.Quantity</span></h4>
						}else
						{
							<h4 class="text-danger"> <span> Out Of stuck </span></h4>
						}

					}
					@if (ViewBag.Productdetails.Count > 0)
					{
						foreach (var item in ViewBag.Productdetails)
						{
							<div class="rating">
								<span class="review-no">@item.TotalRating reviews</span>
								<div class="stars">
									@{
										var average = (int)item.PaverageRating;

									}
									@for (var i = 0; i < average; i++)
									{
										<span class="fa fa-star (@i != null) ? checked"></span>
									}
									@for (var i = 0; i < (5 - average); i++)
									{
										<span class="fa fa-star"></span>
									}
								</div>
							</div>
						}
					}
				</div>
			</div>
			<div class="row py-3">
				<h2 class = "text-center"> Review </h2>
			</div>
			@if (userSession != null)
			{
				<form id="myForm" >
					<input asp-for="ProductId" value="@ViewBag.ProductId" type="hidden"/>
					<input asp-for="UserId" value="@Context.Session.GetInt32("userId")" type="hidden"/>
				
				<div class="row mx-auto my-auto w-75 border " style="background-color:lightgray;">
					
					
						<label>Rating: </label>
						<div class="form-group">
						<select asp-for="Rating" class="custom-select">  
							<option value="" disabled>Choose Number</option>  
							<option value="1">1</option>  
							<option value="2">2</option>
							<option value="2">3</option>  
							<option value="2">4</option>  
							<option value="2">5</option>   
						</select>  
						<span asp-validation-for="Rating" class="text-danger"></span>
						</div>
						
					
					
					<div class="col-md-6">
						
						<label>Comments:</label>
						<textarea asp-for="Comments" type="text" rows="5" cols="60"></textarea>
						<span asp-validation-for="Comments" class="text-danger"></span>
						<div asp-validation-summary="All" class="text-danger"></div>
					
					</div>
					<div class="col-md-2 mt-5 pt-5 text-center">
						 <button type="reset" value="submit " class="btn bg-info" id="btnSubmit">Submit</button>
					</div>

					
				 
					 
				</div>
				</form>
				@if (ViewBag.Productdetails.Count > 0)
				{
					foreach (var item in ViewBag.Productdetails)
					{
						if(item.PReivewDetails != null)
						@foreach (var rev in item.PReivewDetails)
						{
							<div class="commenter-section  px-1">
								<div class="wrapper row m-2 ">
									<div class="col-md-4">
										@foreach (var user in rev.PUserName)
										{
											<h4 class=""> <span> @user  </span></h4>
										}
									</div>
									<div class="col-md-2 ">
										<p> @rev.PReviewDate</p>
									</div>
									<div class="col-md-6 ">
										<div class="rating float-end">
											<div class="stars">
												@{
													var rating = (int)@rev.PRating;
												}
												@for (var i = 1; i <= rating; i++)
												{

													<span class="fa fa-star (@i != null) ? checked "></span>

												}
												@for (var i = 1; i <= (5 - rating); i++)
												{
													<span class="fa fa-star "></span>
												}
											</div>
											@*<span class="review-no">@rev.PRating</span>*@
										</div>
									</div>
								</div>
								<div class="wrapper row m-2">
									<div class="col-md-12">
										<p> @rev.PComment</p>
									</div>

								</div>
								<hr>
							</div>
						}
					}
				}
			}
			else
			{
				<div class="row>">

					<h2><span>You must login to view and review the product</span></h2>
					<p>  <a class="nav-link text-dark" asp-area="" asp-controller="User" asp-action="Login">Login</a></p>
					</div>

					<div class="row">

						</div>
			}
		

				</div>
			</div>
		</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    $(document).ready(function () {

        $("#btnSubmit").click(function () {
            debugger
           

            var data = $("#myForm").serialize();

            $.ajax({

                type: "POST",
                url: "/Review/ReviewProduct",
                data: data,
                success: function (response) {
                    alert("sumitted successfully");
					 window.location.reload();
                }

            })
        })


    })


</script>

<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>